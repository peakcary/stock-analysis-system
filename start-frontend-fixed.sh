#!/bin/bash

# å›ºå®šç«¯å£å¯åŠ¨å‰ç«¯æœåŠ¡è„šæœ¬
# ç¡®ä¿å‰ç«¯æœåŠ¡è¿è¡Œåœ¨8006ç«¯å£

echo "ğŸ” æ£€æŸ¥8006ç«¯å£å ç”¨æƒ…å†µ..."

# æ£€æŸ¥8006ç«¯å£æ˜¯å¦è¢«å ç”¨
PORT_PID=$(lsof -ti :8006)

if [ ! -z "$PORT_PID" ]; then
    echo "âš ï¸  8006ç«¯å£è¢«è¿›ç¨‹ $PORT_PID å ç”¨ï¼Œæ­£åœ¨ç»ˆæ­¢..."
    kill -9 $PORT_PID 2>/dev/null || true
    sleep 2
fi

# å†æ¬¡ç¡®è®¤ç«¯å£å·²é‡Šæ”¾
PORT_PID=$(lsof -ti :8006)
if [ ! -z "$PORT_PID" ]; then
    echo "âŒ æ— æ³•é‡Šæ”¾8006ç«¯å£ï¼Œè¯·æ‰‹åŠ¨å¤„ç†"
    exit 1
fi

echo "âœ… 8006ç«¯å£å·²é‡Šæ”¾"

# è¿›å…¥å‰ç«¯ç›®å½•
cd /Users/peakom/work/stock-analysis-system/frontend

echo "ğŸš€ å¯åŠ¨å‰ç«¯æœåŠ¡åˆ°8006ç«¯å£..."

# å¼ºåˆ¶æŒ‡å®šç«¯å£ï¼Œä¸å…è®¸è‡ªåŠ¨åˆ‡æ¢
exec npm run dev -- --port 8006 --host 0.0.0.0