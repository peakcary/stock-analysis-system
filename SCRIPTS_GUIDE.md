# 📋 脚本使用指南

## 🚀 优化版脚本概述

我们提供了优化版的部署和管理脚本，专门针对管理员认证系统和端口配置进行了优化。

### 📁 脚本文件列表

| 脚本名称 | 功能说明 | 使用方式 |
|---------|----------|----------|
| `deploy.sh` | 环境部署和初始化 | `./deploy.sh` |
| `start.sh` | 启动所有服务 | `./start.sh` |
| `stop.sh` | 停止所有服务 | `./stop.sh` |
| `status.sh` | 查看系统状态 | `./status.sh` |

## 🔧 脚本功能详解

### 1. **deploy.sh** - 环境部署脚本
- ✅ 自动创建管理员用户账号 (`admin/admin123`)
- ✅ 修复 package.json 中的端口配置问题
- ✅ 安装后端 Python 依赖和前端 Node.js 依赖
- ✅ 验证关键服务可用性（MySQL、Node.js、Python）
- ✅ 生成端口配置文件 `ports.env`

### 2. **start.sh** - 服务启动脚本  
- ✅ 使用正确的端口配置启动所有服务
- ✅ 自动清理端口占用
- ✅ 后台启动服务并记录 PID
- ✅ 实时检查启动状态
- ✅ 提供服务访问地址

### 3. **stop.sh** - 服务停止脚本
- ✅ 根据 PID 文件优雅停止服务
- ✅ 强制清理端口占用进程
- ✅ 清理 PID 文件
- ✅ 详细的停止状态报告

### 4. **status.sh** - 系统状态检查
- 🆕 实时服务状态检查
- 🆕 资源使用情况监控  
- 🆕 数据库连接检查
- 🆕 日志文件状态和错误检查
- 🆕 网络可达性检查
- 🆕 系统健康度评估

## 📊 端口配置 

| 服务 | 端口 | 说明 |
|------|------|------|
| API服务 | 3007 | 后端API接口 |
| 客户端 | 8005 | 用户注册登录界面 |
| 管理端 | 8006 | 管理员后台界面 |

## 👤 默认账号

### 管理员账号（管理端 - 端口8006）
- **用户名**: `admin`
- **密码**: `admin123`  
- **访问**: http://localhost:8006
- **权限**: 无查询限制，完整管理权限

### 客户端账号（客户端 - 端口8005）
- 需要注册新账号
- **访问**: http://localhost:8005
- **权限**: 有查询限制，需购买套餐

## 🔄 使用流程

### 首次部署
```bash
# 1. 环境部署和初始化
./deploy.sh

# 2. 启动所有服务
./start.sh

# 3. 检查系统状态
./status.sh
```

### 日常使用
```bash
# 启动系统
./start.sh

# 检查状态  
./status.sh

# 停止系统
./stop.sh
```

## 📝 日志管理

### 查看实时日志
```bash
# 后端API日志
tail -f logs/backend.log

# 客户端日志
tail -f logs/client.log

# 管理端日志
tail -f logs/frontend.log
```

### 日志文件说明
- `logs/backend.log` - 后端API服务日志
- `logs/client.log` - 客户端前端日志  
- `logs/frontend.log` - 管理端前端日志
- `logs/*.pid` - 进程ID文件

## 🚨 故障排除

### 端口被占用
```bash
# 检查端口占用
lsof -ti:3007,8005,8006

# 强制清理端口
lsof -ti:3007,8005,8006 | xargs kill -9
```

### 服务启动失败
```bash  
# 检查详细状态
./status.sh

# 查看错误日志
tail -n 50 logs/backend.log
tail -n 50 logs/client.log  
tail -n 50 logs/frontend.log
```

### 数据库连接问题
```bash
# 检查MySQL服务
mysqladmin ping -h127.0.0.1

# 启动MySQL服务
brew services start mysql  # macOS
```

## ⚠️ 注意事项

### 1. **端口配置冲突**
- 如果遇到端口占用问题，请先运行 `./stop.sh` 清理所有服务
- 然后重新运行 `./deploy.sh` 进行初始化

### 2. **认证系统变更**
- 新系统使用独立的管理员认证
- 管理端和客户端使用不同的认证token
- 如果发现认证问题，请清理浏览器缓存

### 3. **数据库迁移**  
- 部署脚本会自动创建 `admin_users` 表
- 不会影响现有的用户数据和股票数据
- 如有问题请检查 MySQL 服务状态

## 🔍 系统验证

部署完成后，请验证以下内容：

### 1. 服务可访问性
- [ ] http://localhost:3007/docs (API文档)
- [ ] http://localhost:8005 (客户端)  
- [ ] http://localhost:8006 (管理端)

### 2. 管理员登录
- [ ] 使用 `admin/admin123` 登录管理端
- [ ] 能够访问股票列表和管理功能
- [ ] 无查询次数限制提示

### 3. 功能验证
- [ ] 股票数据显示正常
- [ ] 概念数据加载正常
- [ ] 数据导入功能可用

## 📞 技术支持

如果遇到问题，请：
1. 运行 `./status.sh` 获取系统状态
2. 检查相关日志文件
3. 提供详细的错误信息和系统状态报告

---

## 📈 性能建议

### 1. **生产环境配置**
- 修改 `backend/.env` 中的 `SECRET_KEY`
- 设置 `PAYMENT_MOCK_MODE=false` （如果使用真实支付）
- 配置适当的 `CORS` 域名

### 2. **监控和维护**
- 定期运行 `./status.sh` 检查系统健康度
- 监控日志文件大小，必要时清理
- 定期备份数据库数据

### 3. **扩展建议**  
- 可以添加定时任务执行 `./status.sh`
- 可以配置日志轮转避免文件过大
- 可以添加监控告警机制