# 🔧 固定端口开发方案

## 🎯 方案特点

这个固定端口方案完全按照你的需求设计：

- ✅ **固定三个端口**：API(3007)、客户端(8005)、管理端(8006)  
- ✅ **端口冲突处理**：启动时自动检测占用，可选择kill进程或换端口
- ✅ **配置同步**：前后端端口配置自动保持一致
- ✅ **简单易用**：一键启动和停止

## 🚀 固定端口配置

### 默认端口分配：
- **API服务**: 3007 (FastAPI后端)
- **客户端**: 8005 (React前端) 
- **管理端**: 8006 (React管理界面)

### 配置文件：
- `fixed-ports.env` - 端口配置文件
- `client/vite.config.ts` - 客户端代理 → 3007端口
- `frontend/vite.config.ts` - 管理端代理 → 3007端口

## 📋 使用方法

### 快速启动
```bash
# 启动所有服务（固定端口）
./start-fixed-ports.sh

# 停止所有服务
./stop-fixed-ports.sh
```

### 端口冲突处理
启动时如果遇到端口占用，系统会提示：

```
⚠️  端口 3007 (API服务) 被占用
  占用进程: python (PID: 12345)

🔧 处理选项:
  1) Kill 占用进程，继续使用端口 3007 (推荐)
  2) 使用新端口（自动分配）
  3) 手动指定端口

请选择处理方式 [1-3]:
```

**推荐选择选项1**：Kill占用进程，继续使用固定端口

## 🔗 访问地址

启动成功后：
- 🔗 **API文档**: http://localhost:3007/docs
- 📱 **客户端**: http://localhost:8005 → 代理到 3007
- 🖥️ **管理端**: http://localhost:8006 → 代理到 3007

## ✅ API代理验证

系统自动配置Vite代理，前端API请求会正确转发：

```bash
# 直接访问API
curl http://localhost:3007/api/v1/payment/packages

# 通过客户端代理访问（完全相同的响应）
curl http://localhost:8005/api/v1/payment/packages
```

## 🛠️ 生成的工具文件

| 文件 | 用途 |
|------|------|
| `start-fixed-ports.sh` | 固定端口启动脚本 |
| `stop-fixed-ports.sh` | 固定端口停止脚本 |
| `fixed-ports.env` | 端口配置文件 |
| `setup-fixed-ports.sh` | 完整配置脚本（可选） |

## 🔧 优势特点

### 1. 端口固定
- 始终使用相同的端口号
- 便于记忆和访问
- 避免端口混乱

### 2. 冲突处理
- 智能检测端口占用
- 用户自主选择处理方式
- 支持kill进程或分配新端口

### 3. 配置同步
- 前端自动代理到正确的API端口
- 无需手动修改配置文件
- 确保前后端连接正常

### 4. 简单易用
- 一键启动所有服务
- 清晰的状态提示
- 便捷的停止机制

## 🎯 使用场景

这个方案特别适合：
- **团队开发**：所有开发者使用相同端口
- **生产环境**：固定端口便于部署配置  
- **日常开发**：简单快捷的启动流程
- **切换电脑**：端口配置保持一致

## 🆚 与动态端口方案对比

| 特性 | 固定端口方案 | 动态端口方案 |
|------|-------------|-------------|
| 端口一致性 | ✅ 始终相同 | ❌ 可能变化 |
| 使用简便性 | ✅ 容易记忆 | ❌ 需查看配置 |
| 冲突处理 | ✅ 用户选择 | ❌ 自动分配 |
| 团队协作 | ✅ 统一配置 | ❌ 各自不同 |

---

💡 **建议**: 日常开发推荐使用固定端口方案，简单高效！